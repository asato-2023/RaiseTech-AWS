# 第4回課題

## VPCを作成し、EC2・RDSを構築、EC2からRDSに接続し正常であることを確認する。

1. AWS上に新しくVPCを作成する。
2. 作成したVPCにEC2インスタンスを作成する。（public）
3. 作成したVPCにRDSを作成する（private）
4. ローカル環境のターミナルからEC2に接続する。
5. EC2からRDSに接続し、MySQLへのアクセスを確認する。

### VPCを作成
- リソースは「VPCなど」を設定
- 名前タグは自分で命名（以下工程で今回作成するものには、ぶどうにちなんだ名前をつけた）
- IPv4 CIDRブロックは10.0.0.0/16を指定
- IPv6はなし
- AZの数、サブネットの数はデフォルト
- サブネットのCIDRブロックは/24を指定
- NATゲートウェイはデフォルト
- VPCエンドポイントはなしを選択
- DNSオプションはデフォルト

VPC 詳細<br>
![VPC01](./image2/vpc01.png)

VPC Resource map<br>
![VPC02](./image2/vpc02.png)


### ap-northeast-1aにEC2を構築
- マシンイメージはAmazon Linux２を選択
- インスタンスタイプはt2.micro（無料枠）を選択
- 新しいキーペアを作成
- セキュリティグループを設定

インスタンス概要<br>
![EC2-1](./image2/ec2-1.png)

インスタンス詳細<br>
![EC2-2](./image2/ec2-2.png)

ホストとプレイスメントグループ、他<br>
![EC2-3](./image2/ec2-3.png)

セキュリティの詳細<br>
![EC2-4](./image2/ec2-4.png)


### ap-northeast-1aにRDSを構築
- 作成方法は標準作成を選択
- エンジンオプションはMySQLを選択
- テンプレートは無料利用枠を選択
- DBインスタンスはdb.t3.microを選択
- 作成したEC2を起動した状態で「EC2コンピューティングリソースに接続」を選択
- EC2インスタンスは自分で作成したものを選択
- ユーザ名とパスワードを設定
- その他デフォルト

概要、接続とセキュリティ<br>
![RDS-１](./image2/rds-1.png)

接続とセキュリティ続き、セキュリティグループ<br>
![RDS-2](./image2/rds-2.png)

レプリケーション、他<br>
![RDS-3](./image2/rds-3.png)

### ローカルのターミナルからEC2への接続確認
- ターミナルを起動
- `~/.ssh`ディレクトリを作成
- ダウンロードしたpemを`~/.ssh`配下へ移動
- `chmod 600`でパーミッションを変更
- `ssh -i ~/.ssh/○○.pem ec2-user@ec2のグローバルIP`でEC2にSSH接続

EC2にSSH接続<br>
![Terminal01](./image2/terminal01.png)

### EC2からRDSに接続
- `sudo yum install mysql`でmysqlをインストール
- `mysql -u admin -p -h RDSのエンドポイント`でRDSに接続
- 正常に接続されたことを確認

EC2からRDSに接続<br>
![Terminal02](./image2/terminal02.png)


### 感想
なかなか作業時間が取れず、ネット検索で情報収集をしたり<br>
Udemyの昔購入したAWS講座を視聴したりして知見を深めていた。<br>
AWSはコンソールもそうだが、設定画面も移り変わりが激しく<br>
ネットで調べた情報は古くなっていた。<br>
それでも、調査していた甲斐があって実際の構築にはさほど<br>
困ることはなかった。<br>
今回RDSの「EC2コンピューティングリソースに接続」のところで<br>
選択に悩んだ。<br>
RDS – EC2間のワンクリック接続セットアップの機能という説明を読み<br>
今回そちらを選択したが、選択しない場合は設定方法がどう変わるのか<br>
試してみたい（自分への宿題）。